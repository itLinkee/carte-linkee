<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Carte Google Maps avec Map ID</title>
    <style>
      /* Le conteneur de la carte doit avoir une hauteur et une largeur définies */
      #map {
        height: 600px; 
        width: 100%;
      }
    </style>
  </head>

  <body>
    <h1>Exemple de Carte avec Map ID Google</h1>
    
    <!-- Conteneur pour la carte -->
    <div id="map"></div>
    
    <!-- 
      Charge la Google Maps JS API. 
      Le paramètre "callback=initMap" invoque la fonction initMap au chargement du script.
      Les "libraries" peuvent être ajoutées si vous souhaitez des services supplémentaires (places, geometry, etc.).
    -->
    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC-EiSDiT_QITPtDqZmLEJAbiFcLiSb7r0&callback=initMap&libraries=geometry"
    ></script>
    
    <script>
      let map;           // L'objet carte Google Maps
      let markers = [];  // Pour stocker les marqueurs créés
      const dataUrl = "https://raw.githubusercontent.com/itLinkee/carte-linkee/main/data.json"; 
        // ← Remplacez par l'URL de votre JSON
      const REFRESH_INTERVAL = 5 * 60 * 1000

      // Fonction appelée automatiquement une fois l'API chargée
      function initMap() {
        // Initialisation de la carte avec votre Map ID
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 48.8566, lng: 2.3522 },
          zoom: 12,
          mapId: "e7ce213688d1abda"            // ← Votre Map ID créé dans la console Google Cloud
        });

        loadMarkers();

        setInterval(() => {
          loadMarkers();
        }, REFRESH_INTERVAL);
      }

      function loadMarkers(){
        // Récupérer les données (points) depuis data.json
        fetch(dataUrl)
          .then(response => response.json())
          .then(data => {
            cleanMarkers();
            // Pour chaque élément du tableau, on crée un marqueur
            data.forEach(item => {
              addMarker(item);
            });
          })
          .catch(error => {
            console.error("Erreur lors du fetch du JSON:", error);
          });
      }

      // Crée et place un marqueur sur la carte
      function addMarker(item) {
        let iconUrl = "http://maps.google.com/mapfiles/ms/icons/red-dot.png";

        // Ex: style selon "type"
        switch (item.type) {
          case "Pris":
            iconUrl = "http://maps.google.com/mapfiles/ms/icons/green-dot.png";
            break;
          case "Pas pris":
            iconUrl = "http://maps.google.com/mapfiles/ms/icons/red-dot.png";
            break;
          default:
            iconUrl = "http://maps.google.com/mapfiles/ms/icons/yellow-dot.png";
            break;
          }
        const position = { lat: item.lat, lng: item.lng };
        const marker = new google.maps.Marker({
          position,
          map,
          title: item.name || "Point sans nom",
          icon: {
            url: iconUrl,
            scaledSize: new google.maps.Size(32, 32)
          }
        });

        // Exemple: info-bulle à l'ouverture du marqueur
        const infoWindow = new google.maps.InfoWindow({
          content: `<strong>${item.name}</strong><br>
          Statut: ${item.statut}<br>
          Type: ${item.type}<br>
          Partenaire: ${item.partenaire || "Aucun"}<br>`
        });

        marker.addListener("click", () => {
          infoWindow.open(map, marker);
        });

        

        markers.push(marker);
      }

    function cleanMarkers() {
          markers.forEach(m => m.setMap(null));
          markers = [];
        }
    </script>
  </body>
</html>
